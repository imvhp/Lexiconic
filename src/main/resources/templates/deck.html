<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head th:replace="~{fragments/head :: head}"></head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="main-container">
    <div th:replace="~{fragments/navbar :: sidebar}"></div>

    <div class="content">
        <!-- Create/Update form -->
        <form th:action="${deck.id} != null ? @{/decks/{id}(id=${deck.id})} : @{/decks}"
              th:object="${deck}" method="post" class="create-deck-container">


            <input type="hidden" th:field="*{id}" />

            <!-- Left: Deck Info -->
            <div class="deck-section">
                <div class="deck">
                    <div class="record-wrapper">
                        <div class="record-disc"></div>
                        <div class="record-label" id="deckLabel"
                             th:text="*{name != null ? name : 'My Deck'}">My Deck</div>
                        <div class="tonearm"></div>
                    </div>
                </div>

                <div class="deck-inputs">
                    <input type="text" th:field="*{name}" placeholder="Enter Deck Name" required>
                    <textarea th:field="*{description}" placeholder="Enter Deck Description"></textarea>

                    <button type="submit" class="create-btn"
                            th:text="${deck.id != null ? 'Update Deck' : 'Create Deck'}">Save</button>
                </div>
            </div>

            <!-- Right: Flashcards -->
            <div class="flashcard-section">
                <div class="flashcard-form">
                    <h2>Flashcards</h2>
                    <div class="flashcard-container">
                        <div th:each="flashcard, iterStat : *{flashCards}">
                            <div class="flashcard-create" style="position: relative;">
                                <button type="button" class="delete-btn"
                                        style="position: absolute; top: 10px; right: 10px;"
                                        th:attr="data-card-id=${flashcard.id}">
                                    <i class="bi bi-trash"></i>
                                </button>
                                <div class="form-grid">
                                    <div class="column front">
                                        <input type="hidden" th:field="*{flashCards[__${iterStat.index}__].id}" />

                                        <label>Word</label>
                                        <input type="text"
                                               th:field="*{flashCards[__${iterStat.index}__].word}"
                                               placeholder="Enter word" required>

                                        <label>Pronunciation</label>
                                        <input type="text"
                                               th:field="*{flashCards[__${iterStat.index}__].pronunciation}"
                                               placeholder="Enter pronunciation">

                                        <label>Part of Speech</label>
                                        <input type="text"
                                               th:field="*{flashCards[__${iterStat.index}__].partOfSpeech}"
                                               placeholder="e.g., noun">

                                        <label>Audio URL</label>
                                        <input type="text"
                                               th:field="*{flashCards[__${iterStat.index}__].audio}"
                                               placeholder="Paste audio link">
                                    </div>

                                    <div class="column back">
                                        <label>Definition</label>
                                        <textarea th:field="*{flashCards[__${iterStat.index}__].definition}"
                                                  placeholder="Enter definition"></textarea>

                                        <label>Example</label>
                                        <textarea th:field="*{flashCards[__${iterStat.index}__].example}"
                                                  placeholder="Enter example sentence"></textarea>

                                        <label>Image URL</label>
                                        <input type="text"
                                               th:field="*{flashCards[__${iterStat.index}__].image}"
                                               placeholder="Paste image link">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" id="addFlashcardBtn" onclick="addFlashcard()">+ Add Flashcard</button>
                </div>
                <button type="submit" class="create-btn"
                        th:text="${deck.id != null ? 'Update Deck' : 'Create Deck'}">Save</button>
            </div>
        </form>

        <!-- Delete form (separate, not nested) -->
        <div th:if="${deck.id != null}">
            <form th:action="@{/decks/{id}(id=${deck.id})}" method="post" style="display:inline;">
                <input type="hidden" name="_method" value="delete"/>
                <button type="submit" class="delete deck-btn"
                        onclick="return confirm('Are you sure you want to delete this deck?');">
                    Delete Deck
                </button>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/navbar.js"></script>
<script src="/js/create-deck.js"></script>
<script src="/js/delete-flashcard.js"></script>
</body>
</html>
